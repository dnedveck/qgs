---
title: Quantified Grad Student Analysis


---


```{r, echo=FALSE}
# setwd("~/Dropbox/proj/qgs/")
```

```{r setup, message=FALSE}
knitr::opts_chunk$set(tidy = FALSE, fig.height=4, cache=TRUE)
options(stringsAsFactors=FALSE)
## Loading Packages
require(dplyr)
require(lubridate)
require(ggplot2)
```

## Outline
I'll be working with two datasets:

- `clock`: which is when I come into campus, and when I leave
- `gleeo`: which is the tracked time I spent on different tasks throughout each day

In this analysis I am going to:

1. load in the data
 - add in a week count to gleeo and clock
 - add the duration of campustime in clock

2. Answer the question: *How much time do I invest in Grad School?*, which can be broken down into
 - how much time do I spend on campus, per day / week  
 - how much time am I working on grad school stuff, per day / week  
 - What percent of time that I am on campus am I actually getting work done?
  - How efficient am I? (account for time worked not at campus)
 - At the end I want to see "How many hours do I work a week", so that has to be one output.
 
 
 


## import the data
```{r}
gleeo.df <- read.csv(file="2014-05-31_GleeoExport.csv")
clock.df <- read.csv(file="2014-06-15_clocktime.csv")
# Renaming gleeo.df$Start.Date as date for ease of use
names(gleeo.df)[4] <- "date"

```


## Modify the data
### adding week count to `gleeo.df` and `clock.df`
I want to add in a week count, weeks start on Sunday. The reason for this is that I tend to think in week long work blocks.

```{r}
# saturday
format(as.Date("2014-06-7"), "%U")
# sunday
format(as.Date("2014-06-8"), "%U")
```
So, apparently I can set something as a date, and then use the format function to get the week number. It seems that the week starts by default on a Sunday, so that's neat.

since my times don't span over a day, I only need to worry about one of the dates in my `gleeo` data frame

```{r}
gleeo.df$week <- format(ymd(gleeo.df$date), "%U")
clock.df$week <- format(ymd(clock.df$date), "%U")
```

> I had the date in clocktime set as 3/3/2014, which is not the same as 2014-03-03, and hence `as.Date()` had issues with it. So I changed it in my google docs. Also it's nice to have clock and gleeo have the same date format.

### Calculating time stuff
Go Go Lubridate

### Adding the weekday to `gleeo.df` and `clock.df`

```{r}
gleeo.df$day <- wday(ymd(gleeo.df$date), label=TRUE)
clock.df$day <- wday(ymd(clock.df$date), label=TRUE)
```


### Trimming extra days from the `clock.df`
Turns out I had an extra week in the beginning, and then a couple days at the end. So I'm going to trim those dates in `clock.df` to only those that are tracked in `gleeo.df`

```{r}
# clock.df <- clock.df[ymd(clock.df$date) %in% ymd(gleeo.df$date), ]
```

### Getting Tracked time

Here I'm just going to generate a lot of values, and deal with organizing them at the end.

```{r}
# Calculating campustime
clock.df$campustime <- interval(
         ymd_hms(paste(clock.df$date, clock.df$in_time)),
         ymd_hms(paste(clock.df$date, clock.df$out_time))
         ) / ehours(1)
```



```{r}
# Adding ctrackedtime
# getting an interval for the time that I was at campus
campusinter <- interval(
         ymd_hms(paste(clock.df$date, clock.df$in_time)),
         ymd_hms(paste(clock.df$date, clock.df$out_time)))
gleeo.df$taskinter <- interval(
         ymd_hm(paste(gleeo.df$date, gleeo.df$Start.Time)),
         ymd_hm(paste(gleeo.df$date, gleeo.df$End.Time)))
# finding which values fall in these intervals
   # gleeo.df$taskinter %within% campusinter[1] 
    # I'll have to revisit this ... I can think of a way to get this
    # info, but it involves a lot of for loops

# Adding lost time at campus (campus - tracked)


```

## How much time do I invest in Grad School?


### how much time do I spend on campus, per day / week

Overall, what is the amount of time I spend on campus per day, let's look at this with a density plot:
```{r}
ggplot(clock.df, aes(x=campustime)) + 
    geom_histogram(aes(y=..density..),
                   binwidth=.25, color="black", fill="white") + 
    geom_density(alpha=.3, fill="black")


```



Thinking about this, I expect there to be some structure to the times here, as I take a certain bus in, and then take a few possible busses back, so that would explain the lumps in the distribution.
```{r}
clock.df[which(clock.df$campustime <=5), ]
# row 47, 2014-05-16
# clock.df<- filter(clock.df, date!= "2014-05-16" )
```

The outlier on Friday is one day when I left early, I was there only  a half day (prelim season, just wanted to leave early).

```{r}
summary(clock.df$campustime)
```

So, my mean time spent on campus is `r summary(clock.df$campustime)[4]` hrs per day.


For how much time I spend on campus per day, it might be interesting to look at the day (Monday - Sunday)

```{r}
clock.df %>% group_by(day) %>% summarize(daycampus = mean(campustime))
clock.df %>% group_by(day) %>% summarize(daycampus = sd(campustime))

anova(lm(campustime ~ day, data=clock.df))
# marginally signifacnt effect of day on the amount of time I spend on campus, surprising.

ggplot(clock.df, aes(x=day, y=campustime)) + geom_violin()
```

From the plots there's definitely some outliers on Tues and Wed potentially, and there's the half day on Friday coming in at around 4hrs.   


#### and now, per week

Let's look at the distribution of the data:
```{r}
weekclock <- clock.df %>% group_by(week) %>% summarize(weekcampus = sum(campustime))
# is there a week effect?
anova(lm(campustime ~ week, data=clock.df))
# nope

ggplot(weekclock, aes(x=weekcampus)) + 
    geom_histogram(aes(y=..density..),
                   binwidth=1, color="black", fill="white") + 
    geom_density(alpha=.3, fill="black")

```
I guess I really don't have enough points to see an interesting distribution. Maybe there's a bimodal distribution. When I get more data I can see if that is actualy the case (maybe I have productive weeks, and unproductive weeks, and no inbetween) 

Ok, what about a summary of the data
```{r}
summary(weekclock$weekcampus)
```

so, on average I spend `r summary(weekclock$weekcampus)[4]` hours on campus a week.

#### In summary
I spend a mean of `r summary(clock.df$campustime)[4]` hrs per day, and `r summary(weekclock$weekcampus)[4]` hrs per week at campus





### how much time am I working on grad school stuff, per day / week
  - this is the gleeo tracked time
  
```{r}
# Adding tracked time per day (trackedtime)
gleeotime <- gleeo.df %>% group_by(date) %>% 
    summarize(tottrackedtime = sum(Decimal.Duration))

## adding time corrected for personal time
projtimes <- gleeo.df %>% group_by(Project, date) %>%
    summarize(totime = sum(Decimal.Duration))


perstime <- projtimes[which(projtimes$Project == "personal"), 2:3]
names(perstime)[2] <- "perstime"

# left join keeps all the rows of x, not y
trackedtime <- left_join(x=gleeotime, y=perstime, by="date")
# missing values of perstime are NAs, need to be zeros for further work.
trackedtime$perstime[is.na(trackedtime$perstime)] <- 0

# prodtime, tracked time doing productive things
trackedtime$prodtime <- trackedtime$tottrackedtime - trackedtime$perstime

trackedtime$day <- wday(ymd(trackedtime$date), label=TRUE)
trackedtime$week <- format(ymd(trackedtime$date), "%U")
```

Overall, how much productive time do I have per day?
```{r}
ggplot(trackedtime, aes(x=prodtime)) +
    geom_histogram(aes(y=..density..),
                   binwidth=.25, color="black", fill="white") + 
    geom_density(alpha=.3, fill="black")
```
Well, looks like my most common productive time is around 5 hours. The only thing is that this includes Saturday and Sunday. Let's remove those and look at what I have

```{r}
mftt <- trackedtime %>% filter(day != "Sat", day != "Sun")
summary(mftt$prodtime)
summary(trackedtime$prodtime)
# mean is definitely different
ggplot(mftt, aes(x=prodtime)) +
    geom_histogram(aes(y=..density..),
                   binwidth=.25, color="black", fill="white") + 
    geom_density(alpha=.3, fill="black")
```

So the mean productive time per work day is `r summary(mftt$prodtime)[4]` hours.

For furhter work I am going to only be looking at weekday prodtime



How does my prodtime look as a function of each day?
```{r}
anova(lm(prodtime ~ day, mftt))
ggplot(trackedtime, aes(x=day, y=prodtime)) + 
    geom_violin()
```

Is my prodtime a function of week?
```{r}
anova(lm(prodtime ~ week, mftt))
ggplot(trackedtime, aes(x=week, y=prodtime)) + 
    geom_violin()
ggplot(mftt, aes(x=week, y=prodtime)) + 
    geom_violin()
```


How much prodtime do I have per week?

```{r}
wtt <- mftt %>% group_by(week) %>% summarize(wpt = sum(prodtime))
summary(wtt$wpt)
ggplot(wtt, aes(x=wpt)) +
    geom_histogram(aes(y=..density..),
                   binwidth=.25, color="black", fill="white") + 
    geom_density(alpha=.3, fill="black")

ggplot(wtt, aes(x=wpt)) + geom_histogram()
```

Well, that distribution looks pretty crappy. More data will probably fill it in. 


#### Summary

My mean productive time per work day is `r summary(mftt$prodtime)[4]` hours per day, and XX hours per week.



## Efficiency
use prodtime / campustime, correct for dates where I have campus time and not tracked time (extra clock.df days)




```{r}
ggplot(trackedtime, aes(x=week, y=prodtime, group=1)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth() 
```

So the last graph shows that I roughly have the same spread or productive time, and that there is not a trend in weeks.... but I better check that statistically
```{r}
anova(lm(prodtime ~ week, data=trackedtime))
```
Yep, no significant week effect.

*but what about looking at the spread of my productivity times in each week? That could be interesting*

Productive time per week? Is it a function of how much time I spend on campus?
```{r}
# gweekgroup <- group_by(x=trackedtime, week)
# prodweek <- summarize(gweekgroup, weekprodtime = sum(prodtime))
# 
# catch <- data.frame(campus=weekcampus$weektime, prod=prodweek$weekprodtime  )
# ggplot(catch, aes(x=campus, y=prod)) +
#     geom_point(shape=1) +    # Use hollow circles
#     geom_smooth(method=lm)   # Add linear regression line 
                             #  (by default includes 95% confidence region )
```



### What percent of time that I am on campus am I actually getting work done?
  - How efficient am I? (account for time worked not at campus)


### At the end I want to see "How many hours do I work a week", so that has to be one output.

